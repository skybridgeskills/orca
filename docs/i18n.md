# Internationalization (i18n) System

ORCA uses [Paraglide JS](https://inlang.com/m/gerre34r/library-inlang-paraglideJs), a compiler-based i18n library that generates tree-shakable translations, leading to up to 70% smaller i18n bundle sizes compared to runtime i18n libraries.

## Architecture

### Source Files

Translation messages are stored in JSON files at `src/messages/{languageTag}/orca.json` for each supported language:

- `src/messages/en-US/orca.json` - Source language (English, US)
- `src/messages/en-AU/orca.json` - English, Australia
- `src/messages/fr/orca.json` - French
- `src/messages/it/orca.json` - Italian

The supported languages are defined in `project.inlang/settings.json`:

```json
{
	"sourceLanguageTag": "en-US",
	"languageTags": ["en-US", "en-AU", "fr", "it"]
}
```

### Generated Output

Paraglide compiles these source files into TypeScript modules at `src/lib/i18n/`:

- `src/lib/i18n/messages.js` - Generated message functions
- `src/lib/i18n/runtime.js` - Runtime utilities for language switching

**Important**: These files are **generated** and must **never be edited directly**. They are automatically regenerated by the Vite build process.

### Build Process

The Paraglide Vite plugin (configured in `vite.config.js`) automatically compiles messages during development and build:

```javascript
paraglide({
	project: './project.inlang',
	outdir: './src/lib/i18n'
});
```

When you run `pnpm dev` or `pnpm build`, Paraglide:

1. Reads the source message files
2. Generates TypeScript functions for each message key
3. Outputs tree-shakable code to `src/lib/i18n/`

## Usage

### Import Messages

```typescript
import * as m from '$lib/i18n/messages';
```

### Simple Messages

```typescript
const text = m.sunny_watery_sparrow_jest();
// Returns: "This community is suspended or is experiencing technical problems. Please try again later."
```

### Messages with Parameters

Use `{paramName}` syntax in the message string, then pass parameters as an object:

**In JSON** (`src/messages/en-US/orca.json`):

```json
{
	"achievement_awardCountSummary": "{count} awarded."
}
```

**In code**:

```typescript
import * as m from '$lib/i18n/messages';
const text = m.achievement_awardCountSummary({ count: 5 });
// Returns: "5 awarded."
```

### Language Switching

The runtime module provides language switching utilities:

```typescript
import { setLanguageTag, availableLanguageTags } from '$lib/i18n/runtime';

// Set current language
setLanguageTag('fr');

// Get available languages
const languages = availableLanguageTags; // ['en-US', 'en-AU', 'fr', 'it']
```

Language is set per-request in `src/hooks.server.ts` based on the `locale` cookie.

## Message Key Conventions

ORCA uses randomly generated keys in the format: `adjective_adjective_animal_verb`

Examples:

- `sunny_watery_sparrow_jest`
- `cuddly_antsy_rabbit_cook`
- `sparse_happy_kite_march`

This approach provides stable namespace complexity and avoids semantic leakage.

**Note**: Older messages may use semantic keys like `achievement_awardAnotherCTA`, but new messages should use random keys.

## Adding or Editing Messages

### For Humans: Sherlock Extension

The [Sherlock VS Code extension](https://marketplace.visualstudio.com/items?itemName=inlang.vs-code-extension) provides a visual workflow:

1. Select text in your code
2. Press `Cmd+.` (Mac) or `Ctrl+.` (Windows/Linux) to open Quick Fix
3. Choose "Translate" to assign an ID and add translations

### For LLMs: Manual Process

See [`.cursor/commands/i18n-new-message.md`](../.cursor/commands/i18n-new-message.md) for detailed instructions on adding and editing messages programmatically.

**Key points**:

- Always add keys to **all four** language files
- Never edit `src/lib/i18n/` (it's generated)
- Use random keys for new messages
- Use `{paramName}` for interpolation

## Linting

The project includes Inlang lint rules that check for:

- **Missing translations**: All keys must exist in all languages
- **Empty patterns**: Messages with empty `{param}` placeholders
- **Messages without source**: Keys that don't exist in the source language

These rules are configured in `project.inlang/settings.json` and run automatically during development.

## Configuration

The Inlang configuration is in `project.inlang/settings.json`:

- `sourceLanguageTag`: The base language (`en-US`)
- `languageTags`: All supported languages
- `modules`: Lint rules and plugins
- `plugin.inlang.messageFormat.pathPattern`: Path template for message files

## References

- [Paraglide JS Documentation](https://inlang.com/m/gerre34r/library-inlang-paraglideJs)
- [Sherlock VS Code Extension](https://inlang.com/m/r7kp499g/app-inlang-ideExtension)
- [Adding/Editing Messages Guide](../.cursor/commands/i18n-new-message.md)
